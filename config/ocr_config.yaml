# OCR Configuration - OPTIMIZED FOR COMPLETE LINE EXTRACTION
# Version: 2.0 - Improved Detection
# Focus: Capture ALL lines, even low-contrast/small text
# Changes: Lower thresholds, higher resolution, better detection

ocr:
  # Core settings
  use_gpu: false
  use_angle_cls: true
  lang: 'en'
  
  # ⭐ IMPROVED DETECTION SETTINGS
  # Lower threshold = detects more subtle/faint text
  det_db_thresh: 0.15           # CHANGED from 0.2 → 0.15 (more sensitive)
  det_db_box_thresh: 0.5        # Keep same
  det_db_unclip_ratio: 1.2      # CHANGED from 1.6 → 1.2 (smaller boxes, less merging)
  
  # ⭐ IMPROVED RECOGNITION SETTINGS
  # Lower drop_score = accepts lower confidence lines
  rec_batch_num: 6
  drop_score: 0.25              # CHANGED from 0.4 → 0.25 (keeps more text)
  use_space_char: true
  
  # ⭐ IMPROVED RESOLUTION FOR SMALL TEXT
  # Higher resolution = better detection of small/thin text (MTN, barcodes, etc.)
  det_limit_side_len: 2560      # CHANGED from 1920 → 2560 (33% higher resolution)
  det_limit_type: 'max'
  
  # ⭐ IMPROVED DETECTION MODE
  # Slower but more thorough detection
  use_dilation: true
  det_db_score_mode: 'slow'     # CHANGED from 'fast' → 'slow' (more accurate)

# Preprocessing settings
preprocessing:
  auto_rotate: true
  rotation_threshold: 10.0
  
  # ⭐ ENABLE ADAPTIVE ENHANCEMENT
  # Better for low-contrast thermal receipts
  enhance_contrast: true          # CHANGED from false → true
  adaptive_threshold: true        # NEW: Use adaptive thresholding
  clahe_enabled: true            # NEW: Contrast Limited Adaptive Histogram Equalization
  
  # Keep these OFF by default for speed
  sharpen: false
  denoise: false
  
  # Size limits
  max_image_size: 4096
  min_image_size: 100

# Metadata extraction patterns
metadata:
  total_patterns:
    - 'TOTAL\\s*:?\\s*([\\d,]+\\.\\d{2})'
    - 'AMOUNT\\s+DUE\\s*:?\\s*([\\d,]+\\.\\d{2})'
    - 'GRAND\\s+TOTAL\\s*:?\\s*([\\d,]+\\.\\d{2})'
    - 'TOTAL\\s+PAYMENT\\s*:?\\s*([\\d,]+\\.\\d{2})'
    - 'TOTAL\\s+AMOUNT\\s*:?\\s*([\\d,]+\\.\\d{2})'
  
  date_patterns:
    - '(\\d{2}/\\d{2}/\\d{4})'
    - '(\\d{4}-\\d{2}-\\d{2})'
    - '(\\d{2}-\\d{2}-\\d{4})'
    - '(\\d{2}-\\d{2}-\\d{2})'
  
  merchant_lines: 3

# Text enhancement settings (for post-processing)
text_enhancement:
  enabled: true
  restore_spacing: true
  restore_special_chars: true
  patterns:
    # Phone numbers: restore spacing
    phone: true
    # TIN numbers: preserve dashes
    tin: true
    # VAT formatting
    vat: true
    # Item counts: add space
    items: true

# Performance settings
performance:
  # Use multithreading for batch processing
  use_multiprocessing: false  # Set to true if processing many receipts
  max_workers: 4
  
  # Cache preprocessed images
  cache_preprocessed: false
  
  # Logging
  log_level: 'INFO'
  save_debug_images: false  # Set to true for troubleshooting